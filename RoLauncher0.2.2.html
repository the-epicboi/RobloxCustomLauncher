<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Roblox Launcher - Liquid Glass Edition</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Configure Tailwind to enable dynamic classes for blur control
    tailwind.config = {
      theme: {
        extend: {
          // Custom class for non-blurred, solid backgrounds
          backgroundColor: {
            'card-solid': '#18181b', // A dark gray for non-blurred cards
            'nav-solid': '#000000', // Solid black for non-blurred sidebar
          }
        }
      }
    }
  </script>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
    }

    main {
      min-height: 100vh;
    }

    /* Custom scrollbar for sleek look */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    /* Main content area offset for fixed sidebar */
    .content-area {
      margin-left: 16rem; /* Matches w-64 */
      padding: 2.5rem;    /* Matches p-10 */
    }

    /* Responsive adjustments for mobile */
    @media (max-width: 768px) {
      .content-area {
        margin-left: 0;
        padding-top: 6rem; /* space under fixed sidebar row */
      }
      .sidebar {
        width: 100%;
        height: auto;
        position: fixed;
        z-index: 10;
        flex-direction: row;
        justify-content: space-around;
        border-right: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1rem 0;
        top: 0;
        left: 0;
        right: 0;
        /* Blur is handled by dynamic class now */
        background: rgba(0,0,0,0.2); 
        backdrop-filter: blur(10px);
      }
      .sidebar.no-blur {
        background: #000000; /* Solid black for mobile no-blur */
        backdrop-filter: none;
      }
      .sidebar h1 {
        display: none;
      }
      .sidebar nav {
        flex-direction: row;
        width: 100%;
        justify-content: space-around;
        align-items: center;
        margin-top: 0;
      }
      .sidebar button {
        padding: 0.5rem 0.75rem;
        flex-direction: column;
        text-align: center;
        font-size: 0.875rem;
      }
      .sidebar button span {
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useContext, createContext, useEffect } = React;

    // === Context for Global Settings ===
    const SettingsContext = createContext({
      isBlurEnabled: true,
      toggleBlur: () => {},
    });

    const useSettings = () => useContext(SettingsContext);

    // === Icons (inline SVGs) ===
    const LayoutGrid = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="3" y="3" width="7" height="7" rx="1" />
        <rect x="14" y="3" width="7" height="7" rx="1" />
        <rect x="14" y="14" width="7" height="7" rx="1" />
        <rect x="3" y="14" width="7" height="7" rx="1" />
      </svg>
    );

    const Store = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M22 7H2v10h20M6 13l4 4 6-6" />
        <path d="M3 7v10" />
        <path d="M21 7v10" />
      </svg>
    );

    const HelpCircle = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10" />
        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
        <path d="M12 17h.01" />
      </svg>
    );

    const Settings = (props) => (
        <svg {...props} xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.44a2 2 0 0 0-1.78 1.11L7 8.33l-2.73-2.73a2 2 0 0 0-2.83 2.83L4.67 11l-2.73 2.73a2 2 0 0 0 2.83 2.83L7 13.67l.78 1.11a2 2 0 0 0 1.78 1.11V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-4.44a2 2 0 0 0 1.78-1.11L17 11.67l2.73 2.73a2 2 0 0 0 2.83-2.83L19.33 11l2.73-2.73a2 2 0 0 0-2.83-2.83L17 8.33l-.78-1.11A2 2 0 0 0 14.22 5V4a2 2 0 0 0-2-2z"/>
            <circle cx="12" cy="11" r="3"/>
        </svg>
    );

    const Search = (props) => (
        <svg {...props} xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.3-4.3" />
        </svg>
    );

    const ChevronDown = (props) => (
        <svg {...props} xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="m6 9 6 6 6-6" />
        </svg>
    );

    const Copy = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect width="13" height="13" x="9" y="9" rx="2" ry="2" />
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
      </svg>
    );

    const RotateCcw = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-3.6 7.5H3" />
        <path d="M3 11v6H9" />
      </svg>
    );

    const Check = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="20 6 9 17 4 12" />
      </svg>
    );
    
    // === Data: Quiz & Games ===
    const quizQuestions = [
      { question: "What is the official virtual currency used in Roblox?", options: ["Gems", "Robux", "Coins", "Blox"], answer: "Robux" },
      { question: "What does 'Obby' stand for in Roblox?", options: ["Official Lobby", "Obstacle Course", "Obby's World", "Orange Blobby"], answer: "Obstacle Course" },
      { question: "What company develops and publishes Roblox?", options: ["Epic Games", "Mojang", "Roblox Corporation", "Electronic Arts"], answer: "Roblox Corporation" },
      { question: "What is the name of the default character avatar given to new players?", options: ["Steve", "Default Dan", "Bacon Hair", "Noob"], answer: "Noob" },
      { question: "Can you create and publish your own games on Roblox?", options: ["Yes", "No", "Only if you pay", "Only on PC"], answer: "Yes" },
    ];
    
    // Updated GAME_MAP with high-accuracy genres
    const GAME_MAP = [
      { name: 'Brookhaven ðŸ¡RP', universeId: 4924922222, genre: 'Roleplay' },
      { name: 'Adopt Me! ðŸ¥š', universeId: 920587237, genre: 'Roleplay' },
      { name: 'Tower of Hell ðŸ§—', universeId: 1962086868, genre: 'Obby' },
      { name: 'Blox Fruits âš”ï¸', universeId: 2753915549, genre: 'Action-RPG' },
      { name: 'Murder Mystery 2 ðŸ”ª', universeId: 142823291, genre: 'Horror/Mystery' },
      { name: 'Piggy ðŸ·', universeId: 4490140739, genre: 'Horror' },
      { name: 'Royale High ðŸ‘‘', universeId: 735030788, genre: 'Roleplay' },
      { name: 'Arsenal ðŸ”«', universeId: 286090429, genre: 'PVP/Action' },
      { name: 'Jailbreak ðŸš¨', universeId: 606849621, genre: 'Action/Roleplay' },
      { name: 'MeepCity ðŸï¸', universeId: 4972091010, genre: 'Roleplay' },
      { name: 'Natural Disaster Survival ðŸŒªï¸', universeId: 189707, genre: 'Survival' },
      { name: 'Work at a Pizza Place ðŸ•', universeId: 192800, genre: 'Job/Roleplay' },
      { name: 'Welcome to Bloxburg ðŸ—ï¸', universeId: 185655149, genre: 'Simulation' },
      { name: 'The Mimic ðŸ‘»', universeId: 6243691305, genre: 'Horror' },
      { name: 'Evade ðŸƒ', universeId: 9872472334, genre: 'Survival/Horror' },
      { name: 'Doors ðŸšª', universeId: 6516141723, genre: 'Horror' },
      { name: 'Pet Simulator X ðŸ¶', universeId: 6284583030, genre: 'Simulator' },
      { name: 'BedWars ðŸ›ï¸', universeId: 6872265039, genre: 'PVP/Action' },
      { name: 'Flee the Facility ðŸ”‘', universeId: 893973440, genre: 'Horror/Mystery' },
      { name: 'Epic Minigames ðŸ•¹ï¸', universeId: 133211152, genre: 'Minigames' },
      { name: 'Sonic Speed Simulator ðŸ’¨', universeId: 9049840490, genre: 'Adventure/Simulator' },
      { name: 'Anime Fighters Simulator ðŸ”¥', universeId: 6299805724, genre: 'Simulator/PVP' },
      { name: 'Shindo Life ðŸœ', universeId: 4616652839, genre: 'Action-RPG' },
      { name: 'King Legacy âš”ï¸', universeId: 4520749081, genre: 'Action-RPG' },
      { name: 'Build A Boat For Treasure â›µ', universeId: 537413528, genre: 'Adventure' },
      { name: 'All Star Tower Defense ðŸ—¼', universeId: 4996049426, genre: 'Strategy' },
      { name: 'Tower Defense Simulator ðŸ‘¾', universeId: 3260590327, genre: 'Strategy' },
      { name: 'Funky Friday ðŸŽ¤', universeId: 6447798030, genre: 'Music/Rhythm' },
      { name: 'My Restaurant ðŸ½ï¸', universeId: 4490140739, genre: 'Tycoon' },
      { name: 'Zombie Uprising ðŸ§Ÿ', universeId: 5101169549, genre: 'Action/Survival' },
      { name: 'GPO ðŸ´â€â˜ ï¸', universeId: 1730877806, genre: 'Action-RPG' },
      { name: 'Your Bizarre Adventure ðŸ’«', universeId: 2802484924, genre: 'Action-RPG' },
      { name: 'Strongman Simulator ðŸ’ª', universeId: 6766156863, genre: 'Simulator' },
      { name: 'Mining Simulator 2 â›ï¸', universeId: 9551640993, genre: 'Simulator' },
      { name: 'Car Dealership Tycoon ðŸš—', universeId: 1554960397, genre: 'Tycoon' },
      { name: 'Survive the Killer! ðŸ”ª', universeId: 4597012010, genre: 'Horror/Survival' },
      { name: 'Loomian Legacy ðŸ”®', universeId: 3061645787, genre: 'Collection/Adventure' },
      { name: 'Mad City ðŸš”', universeId: 1224212277, genre: 'Action/Roleplay' },
      { name: 'Theme Park Tycoon 2 ðŸŽ¢', universeId: 69184822, genre: 'Tycoon' },
      { name: 'Super Striker League âš½', universeId: 3101667897, genre: 'Sports' },
      { name: 'Islands ðŸï¸', universeId: 4872321990, genre: 'Survival/Adventure' },
      { name: 'Dragon Adventures ðŸ‰', universeId: 3475397644, genre: 'Collection/Adventure' },
      { name: 'Starving Artists ðŸŽ¨', universeId: 9551640993, genre: 'Art/Roleplay' },
      { name: 'Creatures of Sonaria ðŸ¾', universeId: 5233782396, genre: 'Simulation/Survival' },
      { name: 'Vehicle Simulator ðŸŽï¸', universeId: 171391948, genre: 'Simulation' },
      { name: 'Escape Room ðŸ—ï¸', universeId: 294790062, genre: 'Puzzle' },
      { name: 'Weight Lifting Simulator ðŸ‹ï¸', universeId: 176246610, genre: 'Simulator' },
      { name: 'Anime Dimensions âœ¨', universeId: 6938803436, genre: 'Action-RPG' },
      { name: 'Restaurant Tycoon 2 ðŸ‘©â€ðŸ³', universeId: 2810309537, genre: 'Tycoon' },
    ];
    
    const CATALOG_ITEMS = [
      { name: 'Dominus Aureus', catalogId: 138932314, priceLabel: 'Varies' },
      { name: 'Valkyrie Helm', catalogId: 1365767, priceLabel: 'Varies' },
      { name: 'Headless Head', catalogId: 134082579, priceLabel: 'Seasonal' },
      { name: 'Korblox Deathspeaker', catalogId: 190, priceLabel: 'Varies' },
      { name: 'Classic Fedora', catalogId: 1029025, priceLabel: 'Varies' },
      { name: 'Ice Valkyrie', catalogId: 4390891467, priceLabel: 'Varies' },
      { name: 'Super Super Happy Face', catalogId: 494291269, priceLabel: 'Varies' }
    ];

    // === Helpers: Thumbnails and deep links ===
    const thumbnailForPlace = (universeId) =>
      `https://assetgame.roblox.com/game/icon-thumbnail/image?assetId=${universeId}&width=512&height=512&format=png`;

    const thumbnailForCatalog = (assetId) =>
      `https://www.roblox.com/v1/assets/${assetId}/thumbnail?size=420x420&format=Png`;

    const buildLaunch = (placeId) => {
      const deepLink = `roblox://experiences/start?placeId=${placeId}`;
      const webLink = `https://www.roblox.com/games/${placeId}`;
      return { deepLink, webLink };
    };

    const catalogUrl = (catalogId) => `https://www.roblox.com/catalog/${catalogId}`;

    const generateGames = (gameMap) => {
      return gameMap.map((entry, i) => {
        const imageUrl = entry.universeId
          ? thumbnailForPlace(entry.universeId)
          : `https://placehold.co/300x200/111111/FFFFFF?text=${encodeURIComponent((entry.name || 'Game').replace(/[^\w\s]/g, ''))}`;

        const { deepLink, webLink } = entry.universeId ? buildLaunch(entry.universeId) : { deepLink: null, webLink: null };

        return {
          id: i,
          name: entry.name,
          genre: entry.genre,
          placeId: entry.universeId,
          imageUrl,
          deepLink,
          webLink
        };
      });
    };

    const generateItems = (count) => {
      const items = [];
      for (let i = 0; i < count; i++) {
        const src = CATALOG_ITEMS[i % CATALOG_ITEMS.length];
        items.push({
          id: i,
          name: src.name,
          price: src.priceLabel,
          imageUrl: thumbnailForCatalog(src.catalogId),
          linkUrl: catalogUrl(src.catalogId),
        });
      }
      return items;
    };

    // === Reusable components ===
    const GlassCard = ({ children, className = '', ...props }) => {
      const { isBlurEnabled } = useSettings();
      // Conditional classes for blur/solid background
      const blurClasses = isBlurEnabled
        ? 'bg-black/30 backdrop-blur-xl border border-white/10'
        : 'bg-card-solid border border-gray-700';

      return (
        <div
          className={`rounded-2xl shadow-xl transition-all duration-300 hover:shadow-2xl hover:border-white/20 ${blurClasses} ${className}`}
          {...props}
        >
          {children}
        </div>
      );
    };

    const NavButton = ({ icon, label, active, onClick }) => (
      <button
        onClick={onClick}
        className={`flex w-full items-center space-x-3 p-3.5 rounded-xl text-lg font-semibold transition-all duration-200 ${
          active
            ? 'bg-emerald-500/90 text-white shadow-lg shadow-emerald-500/30'
            : 'text-gray-300 hover:bg-white/10 hover:text-white'
        }`}
      >
        {icon}
        <span>{label}</span>
      </button>
    );

    const GameThumbnail = ({ game }) => {
      const { isBlurEnabled } = useSettings();
      const [hasError, setHasError] = useState(false);

      if (hasError) {
        // Dynamic classes for the error placeholder
        const placeholderClasses = isBlurEnabled
            ? 'bg-black/50 backdrop-blur-lg' // Blurred style
            : 'bg-card-solid';               // Solid style

        return (
          <div className={`w-full h-40 flex items-center justify-center p-4 text-center ${placeholderClasses}`}>
            <span className="text-white text-lg font-bold text-shadow-md">
              {game.name}
            </span>
          </div>
        );
      }

      return (
        <img
          src={game.imageUrl}
          alt={game.name}
          className="w-full h-40 object-cover"
          onError={(e) => {
            setHasError(true);
            e.target.onerror = null;
          }}
        />
      );
    };

    // === Games Section ===
    const GamesSection = () => {
      const allGames = useMemo(() => generateGames(GAME_MAP), []);
      const [launchFeedback, setLaunchFeedback] = useState({ show: false, gameName: '', launchUrl: '' });
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedGenre, setSelectedGenre] = useState('All');
      const { isBlurEnabled } = useSettings();
      
      // Extract unique genres for the selector
      const genres = useMemo(() => {
        const uniqueGenres = new Set(allGames.map(game => game.genre).flatMap(g => g.split('/')));
        return ['All', ...Array.from(uniqueGenres).sort()];
      }, [allGames]);

      // Filtering Logic
      const filteredGames = useMemo(() => {
        const lowerCaseSearch = searchTerm.toLowerCase();

        return allGames.filter(game => {
          // 1. Search Term Filter
          const matchesSearch = game.name.toLowerCase().includes(lowerCaseSearch);

          // 2. Genre Filter
          const matchesGenre = selectedGenre === 'All' || game.genre.includes(selectedGenre);

          return matchesSearch && matchesGenre;
        });
      }, [allGames, searchTerm, selectedGenre]);

      
      const handleGameLaunch = (game) => {
        if (game.deepLink) {
          window.location.href = game.deepLink;
          setLaunchFeedback({
            show: true,
            gameName: game.name.replace(/[^a-zA-Z0-9\s]/g, ''),
            launchUrl: game.deepLink
          });
          setTimeout(() => {
            try {
              if (game.webLink) window.open(game.webLink, '_blank', 'noopener,noreferrer');
            } catch {}
          }, 1200);
        } else if (game.webLink) {
          window.open(game.webLink, '_blank', 'noopener,noreferrer');
          setLaunchFeedback({
            show: true,
            gameName: game.name.replace(/[^a-zA-Z0-9\s]/g, ''),
            launchUrl: game.webLink
          });
        } else {
          setLaunchFeedback({
            show: true,
            gameName: game.name.replace(/[^a-zA-Z0-9\s]/g, ''),
            launchUrl: 'ID missing'
          });
        }

        setTimeout(() => {
          setLaunchFeedback({ show: false, gameName: '', launchUrl: '' });
        }, 4000);
      };

      const toastClasses = isBlurEnabled ? 'backdrop-blur-md' : 'backdrop-blur-none';
      const inputBaseClasses = isBlurEnabled 
        ? 'bg-black/50 border-white/20' 
        : 'bg-card-solid border-gray-600';

      return (
        <div>
          <h2 className="text-4xl font-bold text-white mb-8">Popular Games</h2>
          
          {/* Filtering Controls */}
          <div className="flex flex-col md:flex-row gap-4 mb-8">
            {/* Search Bar */}
            <GlassCard className="flex-1 p-3 flex items-center">
              <Search size={20} className="text-gray-400 mr-3" />
              <input
                type="text"
                placeholder="Search games by name..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className={`w-full text-white text-lg placeholder-gray-500 bg-transparent focus:outline-none`}
              />
            </GlassCard>

            {/* Genre Selector */}
            <GlassCard className="p-3 w-full md:w-56 relative">
              <select
                value={selectedGenre}
                onChange={(e) => setSelectedGenre(e.target.value)}
                className={`w-full text-white text-lg appearance-none bg-transparent cursor-pointer pr-8 focus:outline-none`}
              >
                {genres.map(genre => (
                  <option key={genre} value={genre} className="bg-gray-800 text-white p-2">
                    {genre}
                  </option>
                ))}
              </select>
              <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                <ChevronDown size={20} />
              </div>
            </GlassCard>
          </div>
          
          {/* Game Grid */}
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            {filteredGames.length > 0 ? (
                filteredGames.map((game) => (
                    <GlassCard key={game.id} className="overflow-hidden flex flex-col">
                        <GameThumbnail game={game} />
                        <div className="p-4 flex flex-col flex-grow">
                            <h3 className="text-xl font-bold text-white truncate">{game.name}</h3>
                            <p className="text-sm text-gray-300 mb-4">{game.genre}</p>
                            <button
                                onClick={() => handleGameLaunch(game)}
                                className="block w-full mt-auto text-center bg-emerald-500 hover:bg-emerald-400 text-white font-bold py-2.5 px-4 rounded-lg transition-all duration-200 shadow-lg hover:shadow-emerald-500/40 transform hover:scale-105"
                                disabled={!game.placeId}
                                title={!game.placeId ? 'ID not yet mapped' : 'Play'}
                            >
                                {game.placeId ? 'Play' : 'ID Pending'}
                            </button>
                        </div>
                    </GlassCard>
                ))
            ) : (
                <div className="md:col-span-5 text-center p-12">
                    <p className="text-xl text-gray-400">No games match your current filter and search criteria.</p>
                </div>
            )}
          </div>

          {launchFeedback.show && (
            <div
              className={`fixed bottom-6 right-6 p-4 rounded-xl bg-gray-900/95 ${toastClasses} border border-emerald-500 shadow-2xl transition-opacity duration-300 z-50 max-w-sm`}
            >
              <p className="font-bold text-lg text-emerald-400 mb-1">Launch Attempted!</p>
              <p className="text-md text-white font-medium mb-2">
                <span className="text-gray-300">Game:</span> {launchFeedback.gameName}
              </p>
              <p className="text-sm text-gray-400">
                If the Roblox app didnâ€™t open, your browser may have blocked the protocol.
                A web page fallback opens automatically.
              </p>
              <small className="text-xs text-gray-500 truncate block mt-2">
                URI: {launchFeedback.launchUrl}
              </small>
            </div>
          )}
        </div>
      );
    };

    // === Marketplace Section (unchanged) ===
    const MarketplaceSection = () => {
      const items = useMemo(() => generateItems(20), []);

      const handleBuy = (item) => {
        window.open(item.linkUrl, '_blank', 'noopener,noreferrer');
      };

      return (
        <div>
          <h2 className="text-4xl font-bold text-white mb-8">Marketplace</h2>
          <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6">
            {items.map((item) => (
              <GlassCard key={item.id} className="overflow-hidden p-4">
                <img
                  src={item.imageUrl}
                  alt={item.name}
                  className="w-full h-48 object-cover rounded-lg mb-4"
                  onError={(e) => { e.target.src = 'https://placehold.co/200x200/ff0000/FFFFFF?text=Image+Error'; }}
                />
                <h3 className="text-lg font-semibold text-white truncate">{item.name}</h3>
                <p className="text-md font-bold text-emerald-400 mb-4">{item.price}</p>
                <button
                  onClick={() => handleBuy(item)}
                  className="w-full bg-indigo-500 hover:bg-indigo-400 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 shadow-lg hover:shadow-indigo-500/40"
                  title="Open in Roblox Catalog"
                >
                  Buy
                </button>
              </GlassCard>
            ))}
          </div>
        </div>
      );
    };

    // === Quiz Section (unchanged) ===
    const QuizSection = () => {
      const [currentQuestion, setCurrentQuestion] = useState(0);
      const [score, setScore] = useState(0);
      const [showResult, setShowResult] = useState(false);
      const [generatedCode, setGeneratedCode] = useState(null);
      const [copySuccess, setCopySuccess] = useState(false);

      const handleAnswerClick = (option) => {
        if (option === quizQuestions[currentQuestion].answer) {
          setScore((s) => s + 1);
        }
        const nextQuestion = currentQuestion + 1;
        if (nextQuestion < quizQuestions.length) {
          setCurrentQuestion(nextQuestion);
        } else {
          setShowResult(true);
          const code = 'ROBO-LAUNCHER-' + Math.random().toString(36).substring(2, 10).toUpperCase();
          setGeneratedCode(code);
        }
      };

      const resetQuiz = () => {
        setCurrentQuestion(0);
        setScore(0);
        setShowResult(false);
        setGeneratedCode(null);
        setCopySuccess(false);
      };

      const copyToClipboard = () => {
        const textArea = document.createElement("textarea");
        textArea.value = generatedCode;
        textArea.style.position = "fixed";
        textArea.style.left = "-9999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
          document.execCommand('copy');
          setCopySuccess(true);
          setTimeout(() => setCopySuccess(false), 2000);
        } catch (err) {}
        document.body.removeChild(textArea);
      };

      const currentQuizQuestion = quizQuestions[currentQuestion];

      return (
        <div>
          <h2 className="text-4xl font-bold text-white mb-8">Roblox Quiz</h2>
          <GlassCard className="max-w-3xl mx-auto p-8">
            {showResult ? (
              <div className="text-center">
                <h3 className="text-3xl font-bold text-white mb-4">
                  Quiz Completed!
                </h3>
                <p className="text-xl text-gray-200 mb-6">
                  You scored {score} out of {quizQuestions.length}
                </p>
                {score >= 3 ? (
                  <div>
                    <p className="text-lg text-emerald-300 mb-4">
                      Congratulations! You've won a mock code:
                    </p>
                    <div className="bg-gray-900 border-2 border-dashed border-emerald-500 p-4 rounded-lg text-center my-6 flex items-center justify-between">
                      <span className="text-3xl font-mono font-bold text-emerald-400 tracking-wider">
                        {generatedCode}
                      </span>
                      <button
                        onClick={copyToClipboard}
                        className="p-2 rounded-lg bg-emerald-500 hover:bg-emerald-400 text-white transition-all duration-200"
                        title="Copy to Clipboard"
                      >
                        {copySuccess ? <Check size={20} /> : <Copy size={20} />}
                      </button>
                    </div>
                  </div>
                ) : (
                  <p className="text-lg text-red-400 mb-4">
                    Nice try! You need a score of 3 or more to win a code.
                  </p>
                )}
                <button
                  onClick={resetQuiz}
                  className="mt-4 flex items-center justify-center gap-2 mx-auto bg-indigo-500 hover:bg-indigo-400 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 shadow-lg hover:shadow-indigo-500/40"
                >
                  <RotateCcw size={18} />
                  Try Again
                </button>
              </div>
            ) : (
              <div>
                <h3 className="text-2xl font-semibold text-white mb-2">
                  Question {currentQuestion + 1}/{quizQuestions.length}
                </h3>
                <p className="text-xl text-gray-200 mb-8">
                  {currentQuizQuestion.question}
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {currentQuizQuestion.options.map((option, index) => (
                    <button
                      key={index}
                      onClick={() => handleAnswerClick(option)}
                      className="block w-full text-left p-4 rounded-lg bg-white/5 backdrop-blur-sm border border-white/10 hover:bg-white/20 transition-all duration-200 text-lg text-white font-medium"
                    >
                      {option}
                    </button>
                  ))}
                </div>
              </div>
            )}
          </GlassCard>
        </div>
      );
    };

    // === Settings Section (unchanged) ===
    const SettingsSection = () => {
      const { isBlurEnabled, toggleBlur } = useSettings();

      return (
        <div>
          <h2 className="text-4xl font-bold text-white mb-8">Settings</h2>
          <GlassCard className="max-w-xl mx-auto p-8">
            <h3 className="text-2xl font-semibold text-white mb-6 border-b border-white/10 pb-4">
              Visual Preferences
            </h3>
            <div className="flex items-center justify-between py-4">
              <div className='flex flex-col'>
                <p className="text-xl font-medium text-white">Enable Liquid Glass Blur</p>
                <p className="text-sm text-gray-400 mt-1">
                  Toggles the transparent, blurred background effect on all cards and menus.
                </p>
              </div>
              
              {/* Toggle Switch */}
              <label htmlFor="blur-toggle" className="flex items-center cursor-pointer">
                <div className="relative">
                  <input
                    type="checkbox"
                    id="blur-toggle"
                    className="sr-only"
                    checked={isBlurEnabled}
                    onChange={toggleBlur}
                  />
                  <div className={`block w-14 h-8 rounded-full ${isBlurEnabled ? 'bg-emerald-600' : 'bg-gray-600'} transition-colors duration-300`}></div>
                  <div
                    className={`dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 ${isBlurEnabled ? 'translate-x-6' : 'translate-x-0'}`}
                  ></div>
                </div>
              </label>
            </div>
            {/* Add more settings options here */}
          </GlassCard>
        </div>
      );
    };

    // === App (shell and Context Provider) ===
    const App = () => {
      const [activeTab, setActiveTab] = useState('games');
      const [isBlurEnabled, setIsBlurEnabled] = useState(true);

      const toggleBlur = () => {
        setIsBlurEnabled(prev => !prev);
      };
      
      const settingsContextValue = useMemo(() => ({
        isBlurEnabled,
        toggleBlur,
      }), [isBlurEnabled]);

      const renderContent = () => {
        switch (activeTab) {
          case 'games': return <GamesSection />;
          case 'marketplace': return <MarketplaceSection />;
          case 'quiz': return <QuizSection />;
          case 'settings': return <SettingsSection />; 
          default: return <GamesSection />;
        }
      };

      // Determine main layout classes based on blur state
      const sidebarBlurClass = isBlurEnabled ? 'bg-black/20 backdrop-blur-2xl' : 'bg-nav-solid backdrop-blur-none';
      const sidebarBorderClass = isBlurEnabled ? 'border-white/10' : 'border-gray-700';

      return (
        <SettingsContext.Provider value={settingsContextValue}>
          <div
            className="min-h-screen w-full font-inter bg-cover bg-center bg-fixed text-white"
            style={{
              backgroundImage: "url('https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=1920&q=80')",
            }}
          >
            {/* Overlay container with blur - Note: The backdrop blur on this main container is removed 
                because we are now conditionally applying blur to the elements themselves. */}
            <div className="flex min-h-screen w-full bg-black/40">
              {/* Sidebar */}
              <aside className={`sidebar w-64 h-screen p-6 ${sidebarBlurClass} ${sidebarBorderClass} border-r flex flex-col fixed top-0 left-0 transition-all duration-300 ${!isBlurEnabled ? 'no-blur' : ''}`}>
                <h1 className="text-3xl font-bold text-white mb-16">
                  Roblox
                  <span
                    className="text-emerald-400"
                    style={{ textShadow: '0 0 10px rgba(16, 185, 129, 0.7)' }}
                  >
                    Launcher
                  </span>
                </h1>
                <nav className="flex flex-col space-y-4">
                  <NavButton
                    icon={<LayoutGrid size={24} />}
                    label="Games"
                    active={activeTab === 'games'}
                    onClick={() => setActiveTab('games')}
                  />
                  <NavButton
                    icon={<Store size={24} />}
                    label="Marketplace"
                    active={activeTab === 'marketplace'}
                    onClick={() => setActiveTab('marketplace')}
                  />
                  <NavButton
                    icon={<HelpCircle size={24} />}
                    label="Quiz"
                    active={activeTab === 'quiz'}
                    onClick={() => setActiveTab('quiz')}
                  />
                  <NavButton
                    icon={<Settings size={24} />}
                    label="Settings"
                    active={activeTab === 'settings'}
                    onClick={() => setActiveTab('settings')}
                  />
                </nav>
              </aside>

              {/* Main content area */}
              <main className="content-area ml-64 flex-1 p-10 overflow-y-auto">
                {renderContent()}
              </main>
            </div>
          </div>
        </SettingsContext.Provider>
      );
    };

    // === Render app ===
    const rootElement = document.getElementById('root');
    ReactDOM.createRoot(rootElement).render(<App />);
  </script>
</body>
</html>